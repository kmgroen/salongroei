---
/**
 * Guide/HowTo Structured Data (JSON-LD) Component
 * For guide pages (how-to, buying guides, comparisons)
 */

interface Props {
  title: string;
  description: string;
  type: 'buying-guide' | 'how-to' | 'comparison' | 'checklist';
  author: string;
  publishedDate: Date;
  updatedDate?: Date;
  estimatedTime?: string;
  url: string;
  image?: string;
  lang: 'nl' | 'en';
  steps?: Array<{
    name: string;
    text: string;
  }>;
}

const {
  title,
  description,
  type,
  author,
  publishedDate,
  updatedDate,
  estimatedTime,
  url,
  image = 'https://salongroei.com/images/og-default.jpg',
  lang,
  steps = [],
} = Astro.props;

const siteUrl = 'https://salongroei.com';
const fullUrl = `${siteUrl}${url}`;
const fullImageUrl = image.startsWith('http') ? image : `${siteUrl}${image}`;

// Determine schema type based on guide type
const getSchemaType = () => {
  if (type === 'how-to' && steps.length > 0) {
    return 'HowTo';
  }
  return 'Article';
};

const schemaType = getSchemaType();

// Build base structure
const baseStructure = {
  '@context': 'https://schema.org',
  '@type': schemaType,
  name: title,
  headline: title,
  description: description,
  image: {
    '@type': 'ImageObject',
    url: fullImageUrl,
    width: 1200,
    height: 630,
  },
  author: {
    '@type': 'Organization',
    name: author,
    url: siteUrl,
  },
  publisher: {
    '@type': 'Organization',
    name: 'Salongroei',
    url: siteUrl,
    logo: {
      '@type': 'ImageObject',
      url: `${siteUrl}/favicon.svg`,
      width: 60,
      height: 60,
    },
  },
  datePublished: publishedDate.toISOString(),
  dateModified: updatedDate ? updatedDate.toISOString() : publishedDate.toISOString(),
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': fullUrl,
  },
  inLanguage: lang === 'nl' ? 'nl-NL' : 'en-US',
};

// Add HowTo-specific fields if applicable
const structuredData = schemaType === 'HowTo' && steps.length > 0
  ? {
      ...baseStructure,
      totalTime: estimatedTime || 'PT30M',
      step: steps.map((step, index) => ({
        '@type': 'HowToStep',
        position: index + 1,
        name: step.name,
        text: step.text,
      })),
    }
  : {
      ...baseStructure,
      articleSection: type === 'buying-guide' ? 'Buying Guide' : 'Guide',
      keywords: 'salon software guide, buying guide, how-to, salon tools',
    };
---

<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
