---
/**
 * Software Application Structured Data (JSON-LD) Component
 * For tool/software pages
 */

interface Pricing {
  starter: {
    price?: number;
    currency?: string;
    isFree?: boolean;
    hasCommission?: boolean;
    commissionRate?: number;
  };
  pro?: {
    price: number;
    currency?: string;
  };
}

interface Props {
  name: string;
  description: string;
  url: string;
  image: string;
  applicationCategory: string;
  operatingSystem: string;
  offers: Pricing;
  rating: {
    score: number;
    count: number;
  };
  features: string[];
  lang: 'nl' | 'en';
}

const {
  name,
  description,
  url,
  image,
  applicationCategory = 'BusinessApplication',
  operatingSystem = 'Web Browser, iOS, Android',
  offers,
  rating,
  features,
  lang,
} = Astro.props;

const siteUrl = 'https://salongroei.com';
const fullUrl = `${siteUrl}${url}`;
const fullImageUrl = image.startsWith('http') ? image : `${siteUrl}${image}`;

// Build offers array based on pricing structure
const offersList = [];

if (offers.starter.isFree) {
  offersList.push({
    '@type': 'Offer',
    price: '0',
    priceCurrency: offers.starter.currency || 'EUR',
    priceSpecification: {
      '@type': 'PriceSpecification',
      price: '0',
      priceCurrency: offers.starter.currency || 'EUR',
    },
    availability: 'https://schema.org/InStock',
  });
} else if (offers.starter.price) {
  offersList.push({
    '@type': 'Offer',
    price: offers.starter.price.toString(),
    priceCurrency: offers.starter.currency || 'EUR',
    priceSpecification: {
      '@type': 'UnitPriceSpecification',
      price: offers.starter.price.toString(),
      priceCurrency: offers.starter.currency || 'EUR',
      unitText: 'MONTH',
    },
    availability: 'https://schema.org/InStock',
  });
}

if (offers.pro?.price) {
  offersList.push({
    '@type': 'Offer',
    price: offers.pro.price.toString(),
    priceCurrency: offers.pro.currency || 'EUR',
    priceSpecification: {
      '@type': 'UnitPriceSpecification',
      price: offers.pro.price.toString(),
      priceCurrency: offers.pro.currency || 'EUR',
      unitText: 'MONTH',
    },
    availability: 'https://schema.org/InStock',
  });
}

const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'SoftwareApplication',
  name: name,
  description: description,
  url: fullUrl,
  image: fullImageUrl,
  applicationCategory: applicationCategory,
  operatingSystem: operatingSystem,
  offers: offersList,
  aggregateRating: {
    '@type': 'AggregateRating',
    ratingValue: rating.score.toString(),
    ratingCount: rating.count.toString(),
    bestRating: '5',
    worstRating: '1',
  },
  featureList: features.join(', '),
  inLanguage: lang === 'nl' ? 'nl-NL' : 'en-US',
  publisher: {
    '@type': 'Organization',
    name: 'Salongroei',
    url: siteUrl,
  },
};
---

<script type="application/ld+json" set:html={JSON.stringify(structuredData)} />
