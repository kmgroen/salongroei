---
import ToolCard from './ToolCard.astro';
import { getCollection } from 'astro:content';
import { getLangFromUrl } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);

const allTools = await getCollection('tools');
const topTools = allTools
    .sort((a, b) => {
        // Prioritize Editor's Pick
        if (a.data.isEditorsPick && !b.data.isEditorsPick) return -1;
        if (!a.data.isEditorsPick && b.data.isEditorsPick) return 1;
        // Then by rating
        return b.data.rating.score - a.data.rating.score;
    })
    .slice(0, 3);

const tools = topTools.map(tool => ({
    name: tool.data.name,
    tagline: tool.data.tagline[lang],
    rating: `${tool.data.rating.score}/5 Rating`,
    badge: tool.data.isEditorsPick ? "Editor's Pick" : undefined,
    imageUrl: tool.data.imageUrl,
    imageAlt: tool.data.imageAlt,
    accentColor: tool.data.accentColor,
    icon: tool.data.isEditorsPick ? 'star' : 'verified',
    metadata: tool.data.isEditorsPick ? "Editor's Pick" : 'Expert Pick',
    slug: tool.data.slug
}));
---
<section class="mb-24">
    <div class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6">
        <div class="max-w-xl">
            <h2 class="font-display text-4xl font-black mb-4">Top Picks for Your Salon</h2>
            <p class="text-lg text-expert-navy/60">Hand-selected by our experts for their exceptional value, ease of use, and design aesthetic.</p>
        </div>
        <button class="flex items-center gap-2 text-primary font-bold hover:gap-4 transition-all">
            View all software <span class="material-symbols-outlined">arrow_forward</span>
        </button>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {tools.map(tool => (
            <ToolCard {...tool} />
        ))}
    </div>
</section>
